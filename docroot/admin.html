<!DOCTYPE html SYSTEM "about:legacy-compat">

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:z2="http://www.hekkelman.com/libzeep/m2" lang="nl">

<head z2:replace="~{head::head(~{::title},~{::head/script})}">
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

	<title>PDB-REDO Session Manager - Admin console</title>

	<script src="scripts/admin.js"></script>
</head>

<body>

	<script z2:inline="javascript">
		const _csrf = /*[[${csrfToken}]]*/ null;
	</script>

	<nav z2:replace="~{menu :: navbar('admin')}" />

	<div class="container">

		<h3 class="mt-3">Admin console</h3>

		<nav>
			<div class="nav nav-tabs" id="nav-tab" role="tablist">
				<button class="nav-link active" id="nav-users-tab" data-bs-toggle="tab" data-bs-target="#nav-users"
					type="button" role="tab" aria-controls="nav-users" aria-selected="true">Users</button>
				<button class="nav-link" id="nav-jobs-tab" data-bs-toggle="tab" data-bs-target="#nav-jobs" type="button"
					role="tab" aria-controls="nav-jobs" aria-selected="false">Jobs</button>
				<button class="nav-link" id="nav-tokens-tab" data-bs-toggle="tab" data-bs-target="#nav-tokens"
					type="button" role="tab" aria-controls="nav-tokens" aria-selected="false">Tokens</button>
				<button class="nav-link" id="nav-updates-tab" data-bs-toggle="tab" data-bs-target="#nav-updates"
					type="button" role="tab" aria-controls="nav-updates" aria-selected="false">Updates</button>
			</div>
		</nav>
		<div class="tab-content" id="nav-tabContent">
			<div class="tab-pane fade show active" id="nav-users" role="tabpanel" aria-labelledby="nav-users-tab"
				tabindex="0">

				<p class="mt-4">Total users: <span z2:text="${users.length}">1</span></p>

				<table class="table table-striped table-sm mt-3" id="users-table">
					<tbody>
						<tr data-keytype="s|s|s|b|s|i|s|s|s|s">
							<th class="sortable">Name</th>
							<th class="sortable">Institution</th>
							<th class="sortable">Email</th>
							<!-- <th class="sortable">Last Login</th> -->
							<th class="sortable">Last Job Number</th>
							<th class="sortable">Last Job Status</th>
							<th class="sortable">Last Job Date</th>
							<th class="sortable">Last Update Request</th>
							<th class="sortable">Created</th>
							<th></th>
						</tr>

						<tr z2:each="user, i : ${users}">
							<td z2:text="${user.name}"></td>
							<td z2:text="${user.institution}"></td>
							<td z2:text="${user.email}"></td>
							<!-- <td z2:text="${user.lastLogin}"></td> -->
							<td z2:text="${user.last-job-nr ? user.last-job-nr}"></td>
							<td z2:text="${user.last-job-status}"></td>
							<td z2:text="${user.last-job-nr ? #dates.format(user.last-job-date, '%F %H:%M')}"></td>
							<td z2:text="${user.last-update-request}"></td>
							<td z2:text="${#dates.format(user.created, '%d %B %Y')}"></td>
							<td><a class="action" href="javascript:void(0);" z2:attr="data-user-id=${user.id}">
									<i class="bi bi-trash"></i>
								</a></td>
						</tr>

					</tbody>
				</table>


			</div>
			<div class="tab-pane fade" id="nav-jobs" role="tabpanel" aria-labelledby="nav-jobs-tab" tabindex="0">

				<table class="table table-striped table-sm mt-3">
					<tbody>
						<tr data-keytype="i|s|i|s|s|s">
							<th class="sortable">Nr</th>
							<th class="sortable">User</th>
							<th class="sortable">Id</th>
							<th class="sortable">Date</th>
							<th class="sortable">Start Time</th>
							<th class="sortable">Status</th>
						</tr>
						<tr class="run-row" z2:each="run, i : ${runs}" z2:data-run-id="|${run.user}-${run.id}|">
							<td z2:text="${i.count}"></td>
							<td z2:text="${run.user}"></td>
							<td z2:text="${run.id}"></td>
							<td z2:text="${#dates.format(run.date, '%F %H:%M')}"></td>
							<td z2:text="${#dates.format(run.started-date, '%F %H:%M')}"></td>
							<td z2:text="${run.status}"></td>
						</tr>
					</tbody>
				</table>

			</div>
			<div class="tab-pane fade" id="nav-tokens" role="tabpanel" aria-labelledby="nav-tokens-tab" tabindex="0">

				<table class="table table-striped table-sm mt-3">
					<thead>
						<tr>
							<th scope="col">#</th>
							<th scope="col">User</th>
							<th scope="col">Session Name</th>
							<th scope="col">Session ID</th>
							<th scope="col">Token</th>
							<th scope="col">Created</th>
							<th scope="col">Expires</th>
							<th scope="col">Action</th>
						</tr>
					</thead>
					<tbody>
						<tr z2:each="session, i: ${sessions}">
							<th scope="row" z2:text="${i.count}"></th>
							<td z2:text="${session.user}"></td>
							<td z2:text="${session.name}"></td>
							<td z2:text="${session.id}"></td>
							<td z2:text="${session.token}"></td>
							<td z2:text="${#dates.format(session.created, '%d %B %Y, %H:%M')}"></td>
							<td z2:text="${#dates.format(session.expires, '%d %B %Y, %H:%M')}"></td>
							<td><a class="action" href="javascript:void(0);" z2:attr="data-sessionid=${session.id}"><i
										class="bi bi-trash"></i></a></td>
						</tr>
					</tbody>
				</table>

			</div>

			<div class="tab-pane fade" id="nav-updates" role="tabpanel" aria-labelledby="nav-updates-tab" tabindex="0">

				<p>updates</p>

			</div>

		</div>



	</div>
</body>

</html>